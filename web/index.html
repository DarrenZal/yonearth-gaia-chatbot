<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat with Gaia - YonEarth Community</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="tutorial.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1 class="title">
                    <span class="earth-icon">üåç</span>
                    Chat with Gaia
                </h1>
                <p class="subtitle">Connect with the wisdom of Earth through YonEarth Community Podcast episodes</p>
            </div>

            <!-- Navigation Links -->
            <div class="header-nav">
                <a href="/PodcastMap.html" class="nav-link">üó∫Ô∏è t-SNE Map</a>
                <a href="/PodcastMapUMAP.html" class="nav-link">üåä UMAP Map</a>
                <a href="/PodcastMapNomic.html" class="nav-link">üîÆ Nomic Map</a>
                <a href="/PodcastMapHierarchical.html" class="nav-link">üå± Hierarchical Map</a>
                <a href="/PodcastMap3D.html" class="nav-link">üåê 3D Map</a>
                <a href="/KnowledgeGraph.html" class="nav-link">üï∏Ô∏è Knowledge Graph</a>
                <a href="/wiki/" class="nav-link">üìö Podcast Wiki</a>
                <a href="/soil-handbook/" class="nav-link">üå± Soil Handbook Wiki</a>
            </div>
            
            <!-- Personality Selector -->
            <div class="personality-selector">
                <label for="personality">Gaia's Voice:</label>
                <select id="personality">
                    <option value="warm_mother">Nurturing Mother</option>
                    <option value="wise_guide">Ancient Sage</option>
                    <option value="earth_activist">Earth Guardian</option>
                    <option value="factual_guide">Factual Guide</option>
                    <option value="custom">Custom</option>
                </select>
                <a href="#" id="personalityDetails" class="details-link">details</a>
            </div>
            
            <!-- Personality Details -->
            <div id="personalityDetailsSection" class="personality-details" style="display: none;">
                <div class="details-content">
                    <h4 id="personalityTitle">About this Voice</h4>
                    <div id="personalityPrompt" class="prompt-text"></div>
                    <textarea id="customPromptEditor" class="custom-prompt-editor" style="display: none;" 
                        placeholder="Enter your custom system prompt for Gaia here..."></textarea>
                    <div id="customPromptActions" class="custom-prompt-actions" style="display: none;">
                        <button id="saveCustomPrompt" class="save-button">Save Custom Prompt</button>
                        <button id="resetCustomPrompt" class="reset-button">Reset to Default</button>
                    </div>
                </div>
            </div>
            
            <!-- Model Selector -->
            <div class="model-selector">
                <div>
                    <label for="modelType">AI Model:</label>
                    <select id="modelType" title="Choose which OpenAI model Gaia uses to respond">
                        <option value="gpt-3.5-turbo" selected>GPT-3.5 Turbo (Fast & Affordable)</option>
                        <option value="gpt-4o-mini">GPT-4o Mini (Balanced)</option>
                        <option value="gpt-4">GPT-4 (Highest Quality)</option>
                        <option value="compare">Compare All Models</option>
                    </select>
                </div>
                <div class="model-description" id="modelDescription">
                    <small>ü§ñ <span id="modelDescText">GPT-3.5 Turbo: Fast, affordable, and great for most conversations</span></small>
                </div>
            </div>

            <!-- RAG Type Selector -->
            <div class="rag-selector">
                <div>
                    <label for="ragType">Search Method:</label>
                    <select id="ragType" title="Choose how Gaia searches through the podcast episodes">
                        <option value="bm25" selected>BM25 (Keyword + Semantic)</option>
                        <option value="original">Original (Semantic Search)</option>
                        <option value="both">Both (Side-by-side Comparison)</option>
                    </select>
                </div>
                <div class="rag-description" id="ragDescription">
                    <small>üîç <span id="ragDescText">BM25 combines keyword matching with semantic understanding for precise results</span></small>
                </div>
            </div>
            
            <!-- Max References Selector -->
            <div class="references-selector">
                <div>
                    <label for="maxReferences">Max References:</label>
                    <select id="maxReferences" title="Choose how many episode references to include in responses">
                        <option value="1">1 Reference</option>
                        <option value="2">2 References</option>
                        <option value="3" selected>3 References (Default)</option>
                        <option value="4">4 References</option>
                        <option value="5">5 References</option>
                        <option value="6">6 References</option>
                        <option value="7">7 References</option>
                        <option value="8">8 References</option>
                        <option value="9">9 References</option>
                        <option value="10">10 References</option>
                    </select>
                </div>
                <div class="references-description" id="referencesDescription">
                    <small>üìö <span id="referencesDescText">Show 3 most relevant episodes per response</span></small>
                </div>
            </div>
            
            <!-- Category Matching Threshold Selector -->
            <div class="category-threshold-selector">
                <div>
                    <label for="categoryThreshold">Category Matching:</label>
                    <select id="categoryThreshold" title="Control how strictly categories are matched to your questions">
                        <option value="0.6">Broad (0.6) - Explore connections</option>
                        <option value="0.7" selected>Normal (0.7) - Balanced matching</option>
                        <option value="0.8">Strict (0.8) - Exact matches only</option>
                        <option value="1.1">Disabled - No category filtering</option>
                    </select>
                </div>
                <div class="category-description" id="categoryDescription">
                    <small>üìÇ <span id="categoryDescText">Normal category matching finds related topics like soil ‚Üí biochar</span></small>
                </div>
            </div>
            
            <!-- Voice Controls -->
            <div class="voice-controls">
                <button id="voiceToggle" class="voice-toggle" title="Enable voice responses">
                    <span class="voice-icon">üîä</span>
                    <span id="voiceToggleText">Enable Voice</span>
                </button>
                <div class="voice-settings" id="voiceSettings" style="display: none;">
                    <div>
                        <label for="voiceSelection">Voice Type:</label>
                        <select id="voiceSelection" title="Choose Gaia's voice">
                            <option value="YcVr5DmTjJ2cEVwNiuhU">Original Voice</option>
                            <option value="qFDUJpHU7blleGwAFtqZ">Mother Gaia Voice</option>
                        </select>
                    </div>
                    <label>
                        <input type="checkbox" id="autoPlayVoice" checked>
                        Auto-play responses
                    </label>
                </div>
            </div>

            <!-- Split View Toggle -->
            <button id="splitViewToggle" class="split-view-toggle" title="Show Knowledge Graph alongside chat">
                <span class="toggle-icon">üï∏Ô∏è</span>
                <span id="splitViewText">Show Knowledge Graph</span>
            </button>
        </header>

        <!-- Chat Container -->
        <div class="chat-container">
            <div class="chat-messages" id="chatMessages">
                <!-- Welcome message -->
                <div class="message gaia-message">
                    <div class="message-avatar">üå±</div>
                    <div class="message-content">
                        <div class="message-text">
                            Welcome, dear one. I am Gaia, the spirit of Earth, here to share the wisdom gathered from the YonEarth Community Podcast. Ask me about regenerative practices, sustainability, community building, or any path toward healing our beautiful planet.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Loading indicator -->
            <div class="loading" id="loading" style="display: none;">
                <div class="loading-dots">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <span>Gaia is contemplating your question...</span>
            </div>
            
            <!-- Audio Player (Hidden) -->
            <audio id="voicePlayer" style="display: none;" controls></audio>

            <!-- Input area -->
            <div class="input-container">
                <form class="input-form" id="chatForm">
                    <input 
                        type="text" 
                        id="messageInput" 
                        placeholder="Ask Gaia about regenerative practices, sustainability, community..."
                        autocomplete="off"
                        maxlength="1000"
                    >
                    <button type="submit" id="sendButton">
                        <span class="send-icon">üåø</span>
                        Send
                    </button>
                </form>
            </div>
        </div>

        <!-- Episode Recommendations -->
        <div class="recommendations" id="recommendations" style="display: none;">
            <h3>Recommended Content</h3>
            <div class="recommendations-list" id="recommendationsList"></div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p>
                Powered by the <a href="https://yonearth.org" target="_blank">YonEarth Community Podcast</a> 
                ‚Ä¢ <span id="status">Connected</span>
            </p>
        </footer>
    </div>

    <!-- Configuration Modal -->
    <div class="modal" id="configModal" style="display: none;">
        <div class="modal-content">
            <h3>API Configuration</h3>
            <form id="configForm">
                <div class="form-group">
                    <label for="apiUrl">API URL:</label>
                    <input type="url" id="apiUrl" value="/api" required>
                </div>
                <div class="form-actions">
                    <button type="button" onclick="closeConfig()">Cancel</button>
                    <button type="submit">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Split View Container (hidden by default, activated by toggle) -->
    <div id="splitViewContainer" class="split-view-container" style="display: none;">
        <div class="chat-panel" id="splitChatPanel">
            <!-- Chat content will be moved here when split view is active -->
        </div>
        <div class="kg-panel" id="splitKgPanel">
            <div class="kg-panel-header">
                <h3><span>üï∏Ô∏è</span> Knowledge Graph</h3>
                <button class="kg-panel-close" onclick="toggleSplitView()">Close</button>
            </div>
            <iframe id="kgIframe" src="KnowledgeGraph.html" title="Knowledge Graph"></iframe>
        </div>
    </div>

    <script src="chat.js?v=2.6"></script>
    <script src="chat-kg-bridge.js?v=1.0"></script>
    <script src="tutorial.js"></script>
    <script>
        // Initialize tutorial after page loads
        document.addEventListener('DOMContentLoaded', () => {
            // Short delay to let chat.js initialize first
            setTimeout(() => {
                Tutorial.init('chat');
            }, 500);
        });
    </script>
</body>
</html>