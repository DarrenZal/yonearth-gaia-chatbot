<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat with Gaia - YonEarth Community</title>
    <link rel="stylesheet" href="styles.css?v=5">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1 class="title">
                    <span class="earth-icon">üåç</span>
                    Chat with Gaia
                </h1>
                <p class="subtitle">Connect with the wisdom of Earth through YonEarth Community Podcast episodes and Books</p>
            </div>

            <!-- Navigation Links -->
            <div class="header-nav">
                <a href="podcast/" class="nav-link">üåê 3D Podcast Map</a>
                <a href="graph/" class="nav-link">üï∏Ô∏è Knowledge Graph</a>
            </div>
            
            <!-- Controls toggle -->
            <button id="controlsToggle" class="controls-toggle" aria-expanded="false" aria-controls="chatControls" style="display: none;">
                <span class="controls-toggle-icon">‚öôÔ∏è</span>
                <span id="controlsToggleText">Show settings</span>
            </button>

            <!-- Collapsible chat controls -->
            <div id="chatControls" class="chat-controls">
                <!-- Personality Selector -->
                <div class="personality-selector">
                    <label for="personality">Gaia's Voice:</label>
                    <select id="personality">
                        <option value="warm_mother">Nurturing Mother</option>
                        <option value="wise_guide">Ancient Sage</option>
                        <option value="earth_activist">Earth Guardian</option>
                        <option value="custom">Custom</option>
                    </select>
                    <a href="#" id="personalityDetails" class="details-link">details</a>
                </div>
                
                <!-- Personality Details -->
                <div id="personalityDetailsSection" class="personality-details" style="display: none;">
                    <div class="details-content">
                        <h4 id="personalityTitle">About this Voice</h4>
                        <div id="personalityPrompt" class="prompt-text"></div>
                        <textarea id="customPromptEditor" class="custom-prompt-editor" style="display: none;" 
                            placeholder="Enter your custom system prompt for Gaia here..."></textarea>
                        <div id="customPromptActions" class="custom-prompt-actions" style="display: none;">
                            <button id="saveCustomPrompt" class="save-button">Save Custom Prompt</button>
                            <button id="resetCustomPrompt" class="reset-button">Reset to Default</button>
                        </div>
                    </div>
                </div>
                
                <!-- Model Selector -->
                <div class="model-selector">
                    <div>
                        <label for="modelType">AI Model:</label>
                        <select id="modelType" title="Choose which OpenAI model Gaia uses to respond">
                            <option value="gpt-3.5-turbo">GPT-3.5 Turbo (Fast & Affordable)</option>
                            <option value="gpt-4o-mini" selected>GPT-4o Mini (Balanced)</option>
                            <option value="gpt-4">GPT-4 (Highest Quality)</option>
                            <option value="compare">Compare All Models</option>
                        </select>
                    </div>
                    <div class="model-description" id="modelDescription">
                        <small>ü§ñ <span id="modelDescText">GPT-4o Mini: Balanced performance with improved reasoning</span></small>
                    </div>
                </div>

                <!-- RAG Type Selector -->
                <div class="rag-selector">
                    <div>
                        <label for="ragType">Search Method:</label>
                        <select id="ragType" title="Choose how Gaia searches through the podcast episodes">
                            <option value="bm25" selected>BM25 (Keyword + Semantic)</option>
                            <option value="original">Original (Semantic Search)</option>
                            <option value="hybrid">Hybrid QA (Graph + BM25)</option>
                            <option value="both">Both (Side-by-side Comparison)</option>
                        </select>
                    </div>
                    <div class="rag-description" id="ragDescription">
                        <small>üîç <span id="ragDescText">BM25 combines keyword matching with semantic understanding for precise results</span></small>
                    </div>
                </div>
                
                <!-- Max References Selector -->
                <div class="references-selector">
                    <div>
                        <label for="maxReferences">Max References:</label>
                        <select id="maxReferences" title="Choose how many episode references to include in responses">
                            <option value="1">1 Reference</option>
                            <option value="2">2 References</option>
                            <option value="3">3 References (Default)</option>
                            <option value="4">4 References</option>
                            <option value="5" selected>5 References</option>
                            <option value="6">6 References</option>
                            <option value="7">7 References</option>
                            <option value="8">8 References</option>
                            <option value="9">9 References</option>
                            <option value="10">10 References</option>
                        </select>
                    </div>
                    <div class="references-description" id="referencesDescription">
                        <small>üìö <span id="referencesDescText">Show 5 most relevant episodes per response</span></small>
                    </div>
                </div>
                
                <!-- Category Matching Threshold Selector -->
                <div class="category-threshold-selector">
                    <div>
                        <label for="categoryThreshold">Category Matching:</label>
                        <select id="categoryThreshold" title="Control how strictly categories are matched to your questions">
                            <option value="0.6">Broad (0.6) - Explore connections</option>
                            <option value="0.7" selected>Normal (0.7) - Balanced matching</option>
                            <option value="0.8">Strict (0.8) - Exact matches only</option>
                            <option value="1.1">Disabled - No category filtering</option>
                        </select>
                    </div>
                    <div class="category-description" id="categoryDescription">
                        <small>üìÇ <span id="categoryDescText">Normal category matching finds related topics like soil ‚Üí biochar</span></small>
                    </div>
                </div>
                
                <!-- Voice Controls -->
                <div class="voice-controls">
                    <button id="voiceToggle" class="voice-toggle" title="Enable voice responses">
                        <span class="voice-icon">üîä</span>
                        <span id="voiceToggleText">Enable Voice</span>
                    </button>
                    <div class="voice-settings" id="voiceSettings" style="display: none;">
                        <div>
                            <label for="voiceSelection">Voice Type:</label>
                            <select id="voiceSelection" title="Choose Gaia's voice">
                                <option value="piper-gaia">Gaia (Natural Voice)</option>
                            </select>
                        </div>
                        <label>
                            <input type="checkbox" id="autoPlayVoice" checked>
                            Auto-play responses
                        </label>
                    </div>
                </div>
            </div>
        </header>

        <!-- Chat Container -->
        <div class="chat-container">
            <div class="chat-messages" id="chatMessages">
                <!-- Welcome message -->
                <div class="message gaia-message">
                    <div class="message-avatar">üå±</div>
                    <div class="message-content">
                        <div class="message-text">
                            Welcome, dear one. I am Gaia, the spirit of Earth, here to share the wisdom gathered from the YonEarth Community Podcast. Ask me about regenerative practices, sustainability, community building, or any path toward healing our beautiful planet.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Loading indicator -->
            <div class="loading" id="loading" style="display: none;">
                <div class="loading-dots">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <span>Gaia is contemplating your question...</span>
            </div>
            
            <!-- Audio Player (Hidden) -->
            <audio id="voicePlayer" style="display: none;" controls></audio>

            <!-- Input area -->
            <div class="input-container">
                <form class="input-form" id="chatForm">
                    <input 
                        type="text" 
                        id="messageInput" 
                        placeholder="Ask Gaia about regenerative practices, sustainability, community..."
                        autocomplete="off"
                        maxlength="1000"
                    >
                    <button type="submit" id="sendButton">
                        <span class="send-icon">üåø</span>
                        Send
                    </button>
                </form>
            </div>
        </div>

        <!-- Episode Recommendations -->
        <div class="recommendations" id="recommendations" style="display: none;">
            <h3>Recommended Content</h3>
            <div class="recommendations-list" id="recommendationsList"></div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p>
                Powered by the <a href="https://yonearth.org" target="_blank">YonEarth Community Podcast</a> 
                ‚Ä¢ <span id="status">Connected</span>
            </p>
        </footer>
    </div>

    <!-- Configuration Modal -->
    <div class="modal" id="configModal" style="display: none;">
        <div class="modal-content">
            <h3>API Configuration</h3>
            <form id="configForm">
                <div class="form-group">
                    <label for="apiUrl">API URL:</label>
                    <input type="url" id="apiUrl" value="/api" required>
                </div>
                <div class="form-actions">
                    <button type="button" onclick="closeConfig()">Cancel</button>
                    <button type="submit">Save</button>
                </div>
            </form>
        </div>
    </div>

    <script src="chat.js?v=3.5"></script>
</body>
</html>
