<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YonEarth Knowledge Graph Explorer</title>
    <!-- Reuse existing 3D map styles for layout and info panel -->
    <link rel="stylesheet" href="index.css">
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: radial-gradient(circle at top, #071521 0%, #02040f 60%, #000000 100%);
            color: #e0f7ff;
        }

        .kg-page {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .kg-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 20px;
            background: rgba(2, 10, 25, 0.95);
            border-bottom: 1px solid rgba(0, 200, 255, 0.25);
            backdrop-filter: blur(8px);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .kg-title-block {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .kg-title {
            font-size: 1.6rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .kg-subtitle {
            font-size: 0.9rem;
            color: #9ecfff;
        }

        .kg-nav {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .kg-nav a {
            padding: 6px 12px;
            border-radius: 999px;
            text-decoration: none;
            font-size: 0.85rem;
            color: #e0f7ff;
            border: 1px solid rgba(0, 200, 255, 0.4);
            background: rgba(0, 30, 60, 0.7);
        }

        .kg-nav a:hover {
            background: rgba(0, 200, 255, 0.15);
        }

        .kg-layout {
            display: grid;
            grid-template-columns: 280px minmax(0, 1fr) 320px;
            gap: 10px;
            padding: 10px;
            flex: 1;
            min-height: 0;
        }

        .kg-sidebar {
            background: rgba(3, 16, 40, 0.96);
            border-radius: 10px;
            border: 1px solid rgba(0, 200, 255, 0.3);
            padding: 10px 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.6);
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-height: calc(100vh - 80px);
            overflow-y: auto;
        }

        .kg-section-title {
            font-size: 0.9rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            color: #9ecfff;
            margin-bottom: 4px;
        }

        .kg-search-input {
            width: 100%;
            padding: 6px 8px;
            border-radius: 6px;
            border: 1px solid rgba(0, 180, 255, 0.5);
            background: rgba(1, 12, 30, 0.9);
            color: #e0f7ff;
            font-size: 0.9rem;
        }

        .kg-search-input::placeholder {
            color: rgba(150, 200, 255, 0.7);
        }

        .kg-search-results {
            margin-top: 6px;
            border-radius: 6px;
            border: 1px solid rgba(0, 180, 255, 0.3);
            background: rgba(1, 12, 30, 0.98);
            max-height: 220px;
            overflow-y: auto;
            display: none;
        }

        .kg-search-result {
            padding: 6px 8px;
            cursor: pointer;
            border-bottom: 1px solid rgba(0, 180, 255, 0.15);
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .kg-search-result:last-child {
            border-bottom: none;
        }

        .kg-search-result:hover {
            background: rgba(0, 180, 255, 0.12);
        }

        .entity-type-pill {
            font-size: 0.7rem;
            padding: 2px 7px;
            border-radius: 999px;
            background: rgba(0, 180, 255, 0.15);
            border: 1px solid rgba(0, 180, 255, 0.6);
            color: #9ecfff;
        }

        .kg-filter-group {
            border-radius: 8px;
            border: 1px solid rgba(0, 200, 255, 0.25);
            background: radial-gradient(circle at top left, rgba(0, 70, 120, 0.6), rgba(1, 12, 30, 0.9));
            padding: 8px 10px;
        }

        .kg-filter-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 4px;
        }

        .kg-chip {
            font-size: 0.78rem;
            padding: 4px 8px;
            border-radius: 999px;
            border: 1px solid rgba(130, 190, 255, 0.5);
            background: rgba(3, 24, 50, 0.9);
            cursor: pointer;
            color: #cfe8ff;
        }

        .kg-chip.active {
            background: rgba(0, 200, 255, 0.25);
            border-color: rgba(0, 200, 255, 0.8);
            color: #ffffff;
        }

        .kg-select-row {
            display: flex;
            gap: 6px;
            margin-top: 4px;
        }

        .kg-select-row select {
            flex: 1;
            padding: 4px 6px;
            border-radius: 6px;
            border: 1px solid rgba(0, 150, 230, 0.6);
            background: rgba(1, 16, 40, 0.92);
            color: #e0f7ff;
            font-size: 0.8rem;
        }

        .kg-checkbox-row {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-top: 4px;
            font-size: 0.8rem;
        }

        .kg-checkbox-row label {
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            padding: 6px 8px;
            border-radius: 6px;
            border: 1px solid rgba(0, 200, 255, 0.25);
            background: rgba(0, 50, 90, 0.4);
            width: 100%;
            box-sizing: border-box;
        }

        .kg-checkbox-row input[type="checkbox"] {
            flex-shrink: 0;
            width: 16px;
            height: 16px;
            margin: 0;
        }

        .kg-slider-row {
            margin-top: 4px;
            font-size: 0.8rem;
        }

        .kg-slider-row input[type="range"] {
            width: 100%;
        }

        .kg-main {
            position: relative;
            border-radius: 10px;
            border: 1px solid rgba(0, 200, 255, 0.35);
            background: radial-gradient(circle at top, #050b18 0%, #000000 60%);
            overflow: hidden;
            min-height: 0;
        }

        #kg-3d-graph {
            width: 100%;
            height: 100%;
        }

        .kg-info-panel {
            background: rgba(3, 16, 40, 0.96);
            border-radius: 10px;
            border: 1px solid rgba(0, 200, 255, 0.3);
            padding: 10px 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.6);
            max-height: calc(100vh - 80px);
            overflow-y: auto;
        }

        .kg-info-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
        }

        .kg-info-title {
            font-size: 1rem;
            font-weight: 600;
        }

        .kg-close-btn {
            border: none;
            background: transparent;
            color: #9ecfff;
            cursor: pointer;
            font-size: 1.1rem;
        }

        .kg-level-breadcrumb {
            font-size: 0.75rem;
            color: #9ecfff;
            margin: 4px 0 6px;
        }

        .kg-level-badge-row {
            display: flex;
            gap: 6px;
            align-items: center;
            margin-bottom: 6px;
        }

        .kg-level-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            opacity: 0.3;
        }

        .kg-level-dot.active {
            opacity: 1;
            box-shadow: 0 0 8px currentColor;
        }

        .kg-entity-meta {
            font-size: 0.8rem;
            color: #cfe8ff;
            margin-top: 6px;
        }

        .kg-sources,
        .kg-related {
            margin-top: 8px;
            font-size: 0.8rem;
        }

        .kg-episode-pill,
        .kg-book-pill {
            display: inline-block;
            margin: 2px 4px 2px 0;
            padding: 2px 6px;
            border-radius: 999px;
            font-size: 0.75rem;
        }

        .kg-episode-pill {
            background: rgba(0, 200, 255, 0.18);
            border: 1px solid rgba(0, 200, 255, 0.8);
            color: #e0f7ff;
        }

        .kg-book-pill {
            background: rgba(140, 200, 120, 0.18);
            border: 1px solid rgba(140, 200, 120, 0.9);
            color: #e9ffe0;
        }

        .kg-relationship-list {
            margin-top: 8px;
            font-size: 0.78rem;
        }

        .kg-relationship-item {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            margin-bottom: 3px;
        }

        .kg-rel-type {
            padding: 1px 4px;
            border-radius: 4px;
            background: rgba(0, 200, 255, 0.18);
            border: 1px solid rgba(0, 200, 255, 0.7);
            font-size: 0.7rem;
        }

        .kg-controls-row {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
            margin-top: 8px;
        }

        .kg-btn {
            border-radius: 999px;
            border: 1px solid rgba(0, 200, 255, 0.7);
            background: rgba(0, 30, 60, 0.9);
            color: #e0f7ff;
            font-size: 0.8rem;
            padding: 4px 10px;
            cursor: pointer;
        }

        .kg-btn.secondary {
            border-color: rgba(255, 160, 80, 0.9);
            background: rgba(60, 30, 5, 0.9);
        }

        .kg-footer-note {
            font-size: 0.7rem;
            color: #7fb4ff;
            margin-top: 6px;
        }

        @media (max-width: 1024px) {
            .kg-layout {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1.1fr auto;
            }

            .kg-sidebar {
                max-height: 260px;
                order: 1;
            }

            .kg-main {
                min-height: 380px;
                order: 2;
            }

            .kg-info-panel {
                max-height: 260px;
                order: 3;
            }
        }
    </style>
</head>
<body>
    <div class="kg-page">
        <header class="kg-header">
            <div class="kg-title-block">
                <div class="kg-title">
                    üï∏Ô∏è YonEarth Knowledge Graph
                </div>
                <div class="kg-subtitle">
                    Full unified graph (39,046 entities ¬∑ 43,297 relationships) with hierarchical clusters
                </div>
            </div>
            <nav class="kg-nav">
                <a href="GraphRAG3D_EmbeddingView.html">üåÄ GraphRAG 3D (Tri-Mode)</a>
                <a href="../">üí¨ Chat with Gaia</a>
                <a href="../podcast/">üéß 3D Podcast Map</a>
            </nav>
        </header>

        <div class="kg-layout">
            <!-- Left: search & filters -->
            <aside class="kg-sidebar">
                <div class="kg-filter-group">
                    <div class="kg-section-title">Visualization Mode</div>
                    <div class="kg-select-row">
                        <select id="kg-view-mode">
                            <option value="holographic">üåÄ Holographic Elevator</option>
                            <option value="full-force">‚ö° Full Force</option>
                        </select>
                    </div>
                    <div class="kg-footer-note">
                        Holographic: hierarchical clusters ‚Ä¢ Full Force: complete force-directed graph
                    </div>
                </div>

                <div>
                    <div class="kg-section-title">Search</div>
                    <input id="kg-search-input" class="kg-search-input" type="text"
                           placeholder="Search entities by name..." />
                    <div id="kg-search-results" class="kg-search-results"></div>
                </div>

                <div class="kg-filter-group" style="display:none;">
                    <div class="kg-section-title">Entity Types</div>
                    <div id="kg-entity-type-chips" class="kg-filter-chips"></div>
                </div>

                <div class="kg-filter-group">
                    <div class="kg-section-title">Sources</div>
                    <div class="kg-select-row">
                        <select id="kg-episode-filter">
                            <option value="">All episodes</option>
                        </select>
                    </div>
                    <div class="kg-select-row" style="margin-top: 4px;">
                        <select id="kg-book-filter">
                            <option value="">All books</option>
                        </select>
                    </div>
                    <div class="kg-footer-note">
                        Filter entities that appear in a specific episode or book.
                    </div>
                </div>

                <div class="kg-filter-group" id="kg-hierarchy-controls">
                    <div class="kg-section-title">Hierarchy Levels</div>
                    <div class="kg-checkbox-row">
                        <label><input type="checkbox" id="kg-level-3" checked /> Level 3 (coarse)</label>
                        <label><input type="checkbox" id="kg-level-2" /> Level 2 (medium)</label>
                        <label><input type="checkbox" id="kg-level-1" /> Level 1 (fine)</label>
                        <label><input type="checkbox" id="kg-level-0" /> Level 0 (entities)</label>
                    </div>
                </div>

                <div class="kg-filter-group" id="kg-membrane-controls" style="display:none;">
                    <div class="kg-section-title">Node Sizing Mode</div>
                    <div class="kg-select-row">
                        <select id="kg-size-mode">
                            <option value="connectivity">üîó Connectivity (Degree)</option>
                            <option value="betweenness">‚ö° Betweenness Centrality</option>
                        </select>
                    </div>
                    <div class="kg-footer-note">
                        Node size based on connectivity or betweenness centrality
                    </div>
                </div>

                <div class="kg-filter-group" id="kg-membrane-toggles" style="display:none;">
                    <div class="kg-section-title">Community Membranes</div>
                    <div class="kg-checkbox-row">
                        <label><input type="checkbox" id="kg-membrane-l3" checked /> L3 Coarse (Red)</label>
                        <label><input type="checkbox" id="kg-membrane-l2" checked /> L2 Medium (Gold)</label>
                        <label><input type="checkbox" id="kg-membrane-l1" /> L1 Fine (Cyan)</label>
                    </div>
                    <div class="kg-footer-note">
                        Toggle cluster membranes at different hierarchy levels
                    </div>
                </div>

                <div class="kg-filter-group">
                    <div class="kg-section-title">Relationships</div>
                    <div class="kg-checkbox-row">
                        <label><input type="checkbox" id="kg-show-hierarchy" checked /> Show hierarchy edges</label>
                        <label><input type="checkbox" id="kg-show-relationships" checked /> Show entity relationships</label>
                    </div>
                    <div class="kg-section-title" style="margin-top: 6px; display:none;">Relationship Types</div>
                    <div id="kg-relationship-type-chips" class="kg-filter-chips" style="display:none;"></div>
                </div>

                <div class="kg-filter-group">
                    <div class="kg-section-title">Level of Detail</div>
                    <div class="kg-slider-row">
                        <label for="kg-max-entities">Max entities per cluster:
                            <span id="kg-max-entities-label">200</span>
                        </label>
                        <input id="kg-max-entities" type="range" min="50" max="600" step="50" value="200" />
                        <div class="kg-footer-note">
                            Lower for faster rendering, higher to see more entities at once.
                        </div>
                    </div>
                </div>

                <div class="kg-controls-row">
                    <button id="kg-reset-view" class="kg-btn secondary">Reset View</button>
                    <button id="kg-export-subgraph" class="kg-btn">Export Subgraph</button>
                </div>

                <div class="kg-footer-note">
                    Tip: click clusters to expand/collapse, drag to rotate, scroll to zoom.
                </div>
            </aside>

            <!-- Center: 3D graph -->
            <main class="kg-main">
                <div id="kg-3d-graph"></div>
            </main>

            <!-- Right: entity info -->
            <aside class="kg-info-panel" id="kg-info-panel">
                <div class="kg-info-header">
                    <div class="kg-info-title" id="kg-node-title">Select a node</div>
                    <button class="kg-close-btn" id="kg-close-panel" title="Close">√ó</button>
                </div>
                <div class="kg-level-badge-row">
                    <span style="font-size: 0.8rem;">Level:</span>
                    <div class="kg-level-dot" data-level="3" style="background:#FF5722;"></div>
                    <div class="kg-level-dot" data-level="2" style="background:#FFC107;"></div>
                    <div class="kg-level-dot" data-level="1" style="background:#4CAF50;"></div>
                    <div class="kg-level-dot" data-level="0" style="background:#2196F3;"></div>
                </div>
                <div class="kg-level-breadcrumb" id="kg-breadcrumb">Coarse categories ¬∑ click a cluster to explore.</div>
                <div id="kg-node-details" style="font-size:0.82rem; margin-top:6px;"></div>
                <div class="kg-entity-meta" id="kg-node-meta"></div>
                <div class="kg-sources" id="kg-node-sources"></div>
                <div class="kg-related" id="kg-node-related"></div>
                <div class="kg-relationship-list" id="kg-node-relationships"></div>
                <div class="kg-controls-row">
                    <button id="kg-focus-node" class="kg-btn">Zoom to Selection</button>
                </div>
                <div class="kg-footer-note">
                    Deep links to podcast timestamps appear when chunk-level metadata is available for this entity.
                </div>
            </aside>
        </div>
    </div>

    <!-- Dependencies -->
    <script src="https://unpkg.com/three@0.150.1/build/three.min.js"></script>
    <script src="https://unpkg.com/3d-force-graph"></script>
    <script src="kg-enhanced.js?v=28"></script>
</body>
</html>
